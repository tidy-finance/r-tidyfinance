% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helper_functions_data_manipulation.R
\name{add_ccm_link_to_crsp}
\alias{add_ccm_link_to_crsp}
\title{Add CCM Links to CRSP Data}
\usage{
add_ccm_link_to_crsp(crsp_data, ccm_link)
}
\arguments{
\item{crsp_data}{A data frame containing CRSP stock data (monthly or daily)
with at least the following columns:
\describe{
\item{\code{permno}}{CRSP permanent security identifier}
\item{\code{date}}{Observation date}
}}

\item{ccm_link}{A data frame containing the CCM linking table with the
following columns:
\describe{
\item{\code{permno}}{CRSP permanent security identifier}
\item{\code{gvkey}}{Compustat global company key}
\item{\code{linkdt}}{First effective date of the link}
\item{\code{linkenddt}}{Last effective date of the link}
}}
}
\value{
The CRSP data frame with an additional \code{gvkey} column containing
the Compustat identifier for observations where a valid link exists. Rows
without a valid link will have \code{NA} for \code{gvkey}.
}
\description{
Merges CRSP stock data with CRSP-Compustat Merged (CCM) linking table to
add Compustat identifiers (\code{gvkey}) to CRSP data. The function ensures that
links are only added when they are valid based on the linking date range
specified in the CCM link table.
}
\details{
The CCM link table connects CRSP's stock identifier (\code{permno}) to Compustat's
company identifier (\code{gvkey}). This function filters the links to ensure that
only valid links are used, where the CRSP date falls within the link's valid
date range (\code{linkdt} to \code{linkenddt}).
}
\examples{
library(tidyfinance)

# Example CRSP monthly data
crsp_monthly <- data.frame(
  permno = c(10001, 10001, 10002, 10002),
  date = as.Date(c("2020-01-31", "2020-02-29", "2020-01-31", "2020-02-29")),
  ret = c(0.05, -0.02, 0.03, 0.01)
)

# Example CCM link table
ccm_link <- data.frame(
  permno = c(10001, 10002),
  gvkey = c("001234", "005678"),
  linkdt = as.Date(c("2010-01-01", "2015-01-01")),
  linkenddt = as.Date(c("2025-12-31", "2025-12-31"))
)

# Add CCM links to CRSP data
crsp_monthly |> add_ccm_link_to_crsp(ccm_link)
}
